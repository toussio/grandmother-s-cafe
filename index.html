<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Reservation</title>

<style>
/* =========================
   THEME TOKENS (Light default)
========================= */
:root{
  --bg:#ffffff;
  --bg-tint:#fff7fa;
  --surface:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e6edf5;

  --pink:#f4b6c6;
  --pink-weak:#fff1f5;
  --pink-strong:#ff6fa3;

  --r:16px;
  --topbar-h:78px;
  --sidebar-w:280px;

  --shadow:0 12px 30px rgba(15, 23, 42, .06);
  --shadow-soft:0 6px 18px rgba(15, 23, 42, .06);

  --topbar-bg: rgba(255,255,255,.82);
  --sidebar-bg: rgba(255,255,255,.90);
}

/* =========================
   DARK THEME OVERRIDES
========================= */
:root[data-theme="dark"]{
  --bg:#0b0f17;
  --bg-tint:#0b0f17;
  --surface:#0f1623;
  --text:#e7eefc;
  --muted:#9aa7bf;
  --line: rgba(148, 163, 184, .18);

  --pink:#ff86b2;
  --pink-weak: rgba(255, 134, 178, .10);
  --pink-strong:#ff4f98;

  --shadow:0 16px 36px rgba(0,0,0,.35);
  --shadow-soft:0 10px 22px rgba(0,0,0,.28);

  --topbar-bg: rgba(15, 22, 35, .78);
  --sidebar-bg: rgba(15, 22, 35, .82);
}

*{box-sizing:border-box;font-family:"Pretendard",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
body{
  margin:0;
  background:linear-gradient(180deg,var(--bg-tint), var(--bg));
  color:var(--text);
  transition: background .2s ease, color .2s ease;
}

/* ===== Topbar ===== */
.topbar{
  position:fixed; inset:0 0 auto 0;
  height:var(--topbar-h);
  background:var(--topbar-bg);
  backdrop-filter: blur(10px);
  border-bottom:1px solid var(--line);
  z-index:50;
  box-shadow:0 10px 20px rgba(0,0,0,.08);
}
.topbar-inner{
  height:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 18px;
}

/* ë¡œê³  */
.brand{display:flex;align-items:center;min-width:140px;}
.brand a{display:flex;align-items:center;text-decoration:none;}
.brand img{
  height:34px;width:auto;object-fit:contain;display:block;
  filter: drop-shadow(0 6px 12px rgba(0,0,0,.10));
}

/* ì˜¤ë¥¸ìª½ ì˜ì—­ */
.top-actions{display:flex;align-items:center;gap:10px;}

/* íƒ­ */
.nav{
  display:flex; gap:8px; align-items:center;
  padding:8px;
  border:1px solid var(--line);
  border-radius:999px;
  background:var(--surface);
  box-shadow:0 6px 14px rgba(0,0,0,.05);
}
.nav button{
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  font-weight:950;
  font-size:14px;
  padding:10px 14px;
  border-radius:999px;
  cursor:pointer;
}
.nav button.active{
  color:#fff;
  background:linear-gradient(135deg, var(--pink-strong), var(--pink));
  box-shadow:0 8px 18px rgba(255, 111, 163, .25);
}

/* í…Œë§ˆ í† ê¸€ */
.theme-btn{
  height:44px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid var(--line);
  background:var(--surface);
  color:var(--text);
  font-weight:950;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow:0 6px 14px rgba(0,0,0,.05);
}
.theme-icon{
  width:26px;height:26px;border-radius:999px;
  display:grid;place-items:center;
  background:var(--pink-weak);
  border:1px solid rgba(255, 134, 178, .35);
  color:var(--pink-strong);
  font-size:14px;
}

/* ===== Sidebar ===== */
.sidebar{
  position:fixed;
  top:var(--topbar-h); left:0; bottom:0;
  width:var(--sidebar-w);
  background:var(--sidebar-bg);
  backdrop-filter: blur(10px);
  border-right:1px solid var(--line);
  padding:14px;
  overflow:auto;
}
.side-card{
  border:1px solid var(--line);
  border-radius:var(--r);
  background:var(--surface);
  padding:14px;
  margin-bottom:14px;
  box-shadow:var(--shadow-soft);
}
.side-title{font-size:13px;font-weight:950;margin-bottom:10px;}
.side-text{color:var(--muted);font-size:13px;line-height:1.55;}
.side-list{
  margin:0;
  padding-left:16px;
  color:var(--muted);
  font-size:13px;
  line-height:1.6;
}
.side-card.tip{
  background:var(--pink-weak);
  border-color:rgba(255, 134, 178, .35);
}

/* ===== Main ===== */
.main{
  margin-top:var(--topbar-h);
  margin-left:var(--sidebar-w);
  padding:28px 18px;
  display:flex;
  justify-content:center;
}
.content{width:100%;max-width: 1020px;}

/* ===== Typography ===== */
.page-title{margin:0;font-size:22px;font-weight:950;letter-spacing:-.02em;}
.page-sub{margin-top:8px;color:var(--muted);font-size:14px;}

/* ===== Cards / Forms ===== */
.grid{
  margin-top:18px;
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
}
.card{
  background:var(--surface);
  border:1px solid var(--line);
  border-radius:20px;
  padding:18px;
  box-shadow:var(--shadow);
}
.card-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}
.card-title strong{font-size:15px;font-weight:950;}
.badge{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  background:linear-gradient(135deg, var(--surface), var(--pink-weak));
  border:1px solid rgba(255, 134, 178, .35);
  color:var(--pink-strong);
  font-weight:950;
}

.field{margin-bottom:12px;}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;}
input, select{
  width:100%;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:var(--surface);
  color:var(--text);
  font-size:14px;
  outline:none;
  transition:.15s ease;
}
input::placeholder{color:rgba(148,163,184,.85);}
input:focus, select:focus{
  border-color:rgba(255,111,163,.55);
  box-shadow:0 0 0 4px rgba(244,182,198,.22);
}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.note{margin-top:10px;font-size:12px;color:var(--muted);}

/* view toggle */
.view{display:none;}
.view.active{display:block;}

/* buttons */
.actions{
  margin-top:14px;
  display:flex;
  gap:10px;
}
.btn{
  flex:1;
  padding:13px 14px;
  border-radius:16px;
  font-weight:950;
  font-size:14px;
  cursor:pointer;
  border:1px solid var(--line);
  background:var(--surface);
  color:var(--text);
  transition:.15s ease;
}
.btn.ghost:hover{filter:brightness(1.02);transform: translateY(-1px);}
.btn.primary{
  border-color:transparent;
  color:#fff;
  background:linear-gradient(135deg, var(--pink-strong), var(--pink));
  box-shadow:0 14px 26px rgba(255,111,163,.25);
}
.btn.primary:hover{filter:brightness(.98);transform: translateY(-1px);}
.btn.small{
  flex:0 0 auto;
  padding:10px 12px;
  border-radius:14px;
  font-size:13px;
}

/* ===== Food layout (left + cart) ===== */
.food-layout{
  margin-top:18px;
  display:grid;
  grid-template-columns: 1fr 380px;
  gap:14px;
}
.cart-list{list-style:none;padding:0;margin:0;font-size:14px;}
.cart-list li{
  padding:10px 0;
  border-bottom:1px dashed var(--line);
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.cart-meta{display:flex;flex-direction:column;gap:4px;}
.cart-meta .muted{color:var(--muted);font-size:12px;}
.cart-total{
  margin-top:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:950;
}
.cart-actions{margin-top:12px;display:flex;gap:10px;}

/* ===== Status ===== */
.kpi-grid{
  margin-top:18px;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:14px;
}
.kpi{
  border:1px solid var(--line);
  border-radius:18px;
  background:var(--surface);
  padding:14px;
  box-shadow:var(--shadow-soft);
}
.kpi .label{color:var(--muted); font-size:12px;}
.kpi .value{margin-top:8px; font-size:22px; font-weight:950;}

.table-wrap{
  margin-top:14px;
  border:1px solid var(--line);
  border-radius:16px;
  overflow:auto;
  background:var(--surface);
}
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  min-width:900px;
}
th, td{
  padding:12px 12px;
  border-bottom:1px solid var(--line);
  text-align:left;
  font-size:13px;
}
th{
  position:sticky;
  top:0;
  background:var(--surface);
  font-weight:950;
}
td .pill{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid rgba(255, 134, 178, .35);
  background:var(--pink-weak);
  color:var(--pink-strong);
  font-weight:900;
  font-size:12px;
}
.status-controls{
  margin-top:14px;
  display:flex;
  gap:10px;
  align-items:center;
}
.status-controls input{max-width:360px;}
.muted-small{color:var(--muted); font-size:12px;}

/* responsive */
@media (max-width: 980px){
  .food-layout{grid-template-columns:1fr;}
  .kpi-grid{grid-template-columns:1fr;}
}
@media (max-width: 820px){
  .sidebar{display:none;}
  .main{margin-left:0;padding:22px 14px;}
  .content{max-width:100%;}
  .row{grid-template-columns:1fr;}
  .brand{min-width:auto;}
  .top-actions{gap:8px;}
  .theme-btn{height:42px;}
}
</style>
</head>

<body>

<header class="topbar">
  <div class="topbar-inner">
    <div class="brand">
      <a href="#" onclick="setView('home'); return false;">
        <img src="https://i.imgur.com/WIPwg1y.png" alt="logo">
      </a>
    </div>

    <div class="top-actions">
      <nav class="nav">
        <button class="tab-btn" data-view="home">ë©”ì¸</button>
        <button class="tab-btn active" data-view="maid">ë©”ì´ë“œ ì˜ˆì•½</button>
        <button class="tab-btn" data-view="food">ìŒì‹ ì˜ˆì•½</button>
        <button class="tab-btn" data-view="status">ì˜ˆì•½ í˜„í™©</button>

        <button class="tab-btn" data-view="admin" id="adminTab" style="display:none;">
          ê´€ë¦¬ì ì „ìš© <span id="adminTabLock">ğŸ”’</span>
        </button>
      </nav>

      <button class="theme-btn" type="button" onclick="toggleTheme()">
        <span class="theme-icon" id="themeIcon">ğŸŒ™</span>
        <span id="themeText">ë‹¤í¬ ëª¨ë“œ</span>
      </button>
    </div>
  </div>
</header>

<aside class="sidebar">
  <div class="side-card">
    <div class="side-title">ì•ˆë‚´</div>
    <div class="side-text">
      ë©”ì´ë“œ ì˜ˆì•½ì€ â€œì˜ˆì•½í•˜ê¸°â€ë¡œ ì ‘ìˆ˜ë©ë‹ˆë‹¤.<br/>
      ìŒì‹ ì˜ˆì•½ì€ â€œë‹´ê¸° â†’ ì£¼ë¬¸ í™•ì •â€ìœ¼ë¡œ ì ‘ìˆ˜ë©ë‹ˆë‹¤.<br/>
      (Firestore ì €ì¥ Â· ìƒˆë¡œê³ ì¹¨ ìœ ì§€)
    </div>
  </div>

  <div class="side-card tip">
    <div class="side-title">TIP</div>
    <ul class="side-list">
      <li>ìŒì‹ ìµœì†Œ 100ê°œë¶€í„°</li>
      <li>í« ë©”ë‰´ëŠ” 100% ì˜ˆì•½ì œ</li>
      <li>ê´€ë¦¬ì ê¶Œí•œ(true) ìŠ¹ì¸ í›„ ê´€ë¦¬ì íƒ­ í‘œì‹œ</li>
      <li>ê´€ë¦¬ì ONì´ë©´ ì˜ˆì•½ í˜„í™©ì—ì„œ ì‚­ì œ ê°€ëŠ¥</li>
    </ul>
  </div>
</aside>

<main class="main">
  <div class="content">

    <!-- VIEW: HOME -->
    <section id="view-home" class="view">
      <h1 class="page-title">ë©”ì¸</h1>
      <div class="page-sub">í™˜ì˜í•©ë‹ˆë‹¤. ë©”ì´ë“œ/ìŒì‹ ì˜ˆì•½ì„ ì§„í–‰í•˜ì„¸ìš”.</div>

      <div class="grid">
        <section class="card">
          <div class="card-title"><strong>ë°”ë¡œê°€ê¸°</strong><span class="badge">START</span></div>
          <div class="actions">
            <button class="btn primary" type="button" onclick="setView('maid')">ë©”ì´ë“œ ì˜ˆì•½</button>
            <button class="btn ghost" type="button" onclick="setView('food')">ìŒì‹ ì˜ˆì•½</button>
            <button class="btn ghost" type="button" onclick="setView('status')">ì˜ˆì•½ í˜„í™©</button>
          </div>
        </section>
      </div>
    </section>

    <!-- VIEW: MAID -->
    <section id="view-maid" class="view active">
      <h1 class="page-title">ë©”ì´ë“œ ì˜ˆì•½</h1>
      <div class="page-sub">ë©”ì´ë“œ ì´ë¦„ / ë‚ ì§œ / ì‹œê°„ / ì˜ˆì•½ ê³ ìœ ë²ˆí˜¸ / ì´ë¦„ / ì´ ì¸ì›ìˆ˜ / ë””ìŠ¤ì½”ë“œ ì•„ì´ë””</div>

      <div class="grid">
        <section class="card">
          <div class="card-title">
            <strong>ì˜ˆì•½ ì •ë³´</strong>
            <span class="badge">í•„ìˆ˜</span>
          </div>

          <div class="field">
            <label>ë©”ì´ë“œ ì´ë¦„</label>
            <select id="maidName">
              <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
            </select>
            <div class="note">â€» ë©”ì´ë“œ ëª©ë¡ì€ ê´€ë¦¬ì ì „ìš©ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.</div>
          </div>

          <div class="row">
            <div class="field">
              <label>ì˜ˆì•½ ë‚ ì§œ</label>
              <select id="maidDate"><option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option></select>
              <div class="note">â€» ë‚ ì§œ ëª©ë¡ì€ ê´€ë¦¬ì ì „ìš©ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.</div>
            </div>
            <div class="field">
              <label>ì˜ˆì•½ ì‹œê°„</label>
              <select id="maidTime"><option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option></select>
              <div class="note">â€» ì‹œê°„ ëª©ë¡ì€ ê´€ë¦¬ì ì „ìš©ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>ì˜ˆì•½ ê³ ìœ ë²ˆí˜¸</label>
              <input type="text" id="maidRid" placeholder="ì˜ˆ: RW-0001">
            </div>
            <div class="field">
              <label>ì´ë¦„</label>
              <input type="text" id="maidUser" placeholder="ì´ë¦„">
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>ì´ ì¸ì›ìˆ˜</label>
              <input type="number" id="maidPeople" placeholder="ì˜ˆ: 3" min="1" step="1">
            </div>
            <div class="field">
              <label>ë””ìŠ¤ì½”ë“œ ì•„ì´ë””</label>
              <input type="text" id="maidDiscord" placeholder="username#0000 ë˜ëŠ” @username">
            </div>
          </div>

          <div class="actions">
            <button class="btn ghost" type="button" onclick="resetMaidForm()">ì´ˆê¸°í™”</button>
            <button class="btn primary" type="button" onclick="submitMaid()">ì˜ˆì•½í•˜ê¸°</button>
          </div>
        </section>
      </div>
    </section>

    <!-- VIEW: FOOD -->
    <section id="view-food" class="view">
      <h1 class="page-title">ìŒì‹ ì˜ˆì•½</h1>
      <div class="page-sub">ë‹´ê¸° ë°©ì‹ Â· ìµœì†Œ 100ê°œ Â· í« ë©”ë‰´ëŠ” ì˜ˆì•½ì œ</div>

      <div class="food-layout">

        <section class="card">
          <div class="card-title"><strong>ë‹´ê¸°</strong><span class="badge">ìµœì†Œ 100ê°œ</span></div>

          <div class="field">
            <label>ë©”ë‰´</label>
            <select id="foodMenu">
              <optgroup label="ì¼ë°˜ ë©”ë‰´ (ìµœì†Œ 100ê°œ)">
                <option value="americano">ì•„ë©”ë¦¬ì¹´ë…¸ (100ë§Œì›)</option>
                <option value="strawberry">ë”¸ë°” ìŠ¤ë¬´ë”” (200ë§Œì›)</option>
                <option value="toast">ì „ë‚¨ì¹œ í† ìŠ¤íŠ¸ (100ë§Œì›)</option>
              </optgroup>
              <optgroup label="í« ë©”ë‰´ (100% ì˜ˆì•½ì œ Â· ìµœì†Œ 100ê°œ)">
                <option value="pet_water">í« ì›Œí„° (100ë§Œì› Â· ì˜ˆì•½ì œ)</option>
                <option value="pet_mineral">í« ë¯¸ë„¤ë„ ì›Œí„° (200ë§Œì› Â· ì˜ˆì•½ì œ)</option>
                <option value="cat_churu">ìº£ì¸„ë¥´ (100ë§Œì› Â· ì˜ˆì•½ì œ)</option>
              </optgroup>
            </select>
          </div>

          <div class="field">
            <label>ìˆ˜ëŸ‰ (ìµœì†Œ 100ê°œ)</label>
            <input type="number" id="foodQty" value="100" min="100" step="1">
          </div>

          <div class="row">
            <div class="field">
              <label>ì˜ˆì•½ ê³ ìœ ë²ˆí˜¸</label>
              <input type="text" id="foodRid" placeholder="ì˜ˆ: FOOD-0001">
            </div>
            <div class="field">
              <label>ì´ë¦„</label>
              <input type="text" id="foodUser" placeholder="ì´ë¦„">
            </div>
          </div>

          <div class="field">
            <label>ë””ìŠ¤ì½”ë“œ ì•„ì´ë””</label>
            <input type="text" id="foodDiscord" placeholder="username#0000 ë˜ëŠ” @username">
          </div>

          <div class="actions">
            <button class="btn primary" type="button" onclick="addToCart()">ë‹´ê¸°</button>
            <button class="btn ghost" type="button" onclick="clearCart()">ì´ˆê¸°í™”</button>
          </div>
        </section>

        <section class="card">
          <div class="card-title"><strong>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</strong><span class="badge">ë³´ê¸°</span></div>

          <ul id="cartList" class="cart-list"></ul>

          <div class="cart-total">
            <span>ì´í•©</span>
            <span><strong id="cartTotal">0</strong> ì–µ</span>
          </div>

          <div class="cart-actions">
            <button class="btn ghost small" type="button" onclick="clearCart()">ë¹„ìš°ê¸°</button>
            <button class="btn primary small" type="button" onclick="confirmFoodOrder()">ì£¼ë¬¸ í™•ì •</button>
          </div>
        </section>

      </div>
    </section>

    <!-- VIEW: STATUS -->
    <section id="view-status" class="view">
      <h1 class="page-title">ì˜ˆì•½ í˜„í™©</h1>
      <div class="page-sub">Firestore ì‹¤ì‹œê°„ ëª©ë¡ (ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€)</div>

      <div class="status-controls">
        <input id="statusSearch" type="text" placeholder="ê²€ìƒ‰: ì˜ˆì•½ë²ˆí˜¸ / ì´ë¦„ / ë””ìŠ¤ì½”ë“œ" oninput="renderStatus()">
        <span class="muted-small">* ê²€ìƒ‰ì€ ì¦‰ì‹œ í•„í„°ë§ë©ë‹ˆë‹¤.</span>
      </div>

      <div class="kpi-grid">
        <div class="kpi">
          <div class="label">ë©”ì´ë“œ ì˜ˆì•½ ê±´ìˆ˜</div>
          <div class="value" id="kpiMaid">0</div>
        </div>
        <div class="kpi">
          <div class="label">ìŒì‹ ì£¼ë¬¸ ê±´ìˆ˜</div>
          <div class="value" id="kpiFood">0</div>
        </div>
        <div class="kpi">
          <div class="label">ìŒì‹ ì´í•©(ì–µ)</div>
          <div class="value" id="kpiFoodTotal">0</div>
        </div>
      </div>

      <div class="grid">
        <section class="card">
          <div class="card-title"><strong>ë©”ì´ë“œ ì˜ˆì•½ ëª©ë¡</strong><span class="badge">í˜„í™©</span></div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ì ‘ìˆ˜ì‹œê°„</th>
                  <th>ì˜ˆì•½ë²ˆí˜¸</th>
                  <th>ì´ë¦„</th>
                  <th>ë””ìŠ¤ì½”ë“œ</th>
                  <th>ë©”ì´ë“œ</th>
                  <th>ë‚ ì§œ</th>
                  <th>ì‹œê°„</th>
                  <th>ì¸ì›</th>
                  <!-- âœ… ê´€ë¦¬ìë§Œ ë³´ì´ëŠ” ì‚­ì œ í—¤ë” -->
                  <th id="maidDelHead" style="display:none;">ì‚­ì œ</th>
                </tr>
              </thead>
              <tbody id="maidStatusBody"></tbody>
            </table>
          </div>
        </section>

        <section class="card">
          <div class="card-title"><strong>ìŒì‹ ì£¼ë¬¸ ëª©ë¡</strong><span class="badge">í˜„í™©</span></div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ì ‘ìˆ˜ì‹œê°„</th>
                  <th>ì˜ˆì•½ë²ˆí˜¸</th>
                  <th>ì´ë¦„</th>
                  <th>ë””ìŠ¤ì½”ë“œ</th>
                  <th>ì´í•©(ì–µ)</th>
                  <th>ìƒì„¸</th>
                  <!-- âœ… ê´€ë¦¬ìë§Œ ë³´ì´ëŠ” ì‚­ì œ í—¤ë” -->
                  <th id="foodDelHead" style="display:none;">ì‚­ì œ</th>
                </tr>
              </thead>
              <tbody id="foodStatusBody"></tbody>
            </table>
          </div>
        </section>
      </div>
    </section>

    <!-- VIEW: ADMIN (ì›ë³¸ ê·¸ëŒ€ë¡œ / ë‚´ìš© ê¸¸ì–´ì„œ ìƒëµ ì—†ì´ ìœ ì§€í•˜ëŠ” í˜•íƒœ) -->
    <section id="view-admin" class="view">
      <h1 class="page-title">ê´€ë¦¬ì ì „ìš©</h1>
      <div class="page-sub">ìŠ¹ì¸(allowed=true) + ê´€ë¦¬ì ON ìƒíƒœì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
      <div class="grid">
        <section class="card">
          <div class="card-title"><strong>ê´€ë¦¬ì</strong><span class="badge">ADMIN</span></div>
          <div class="note" style="margin-top:0;">ê´€ë¦¬ì ê¸°ëŠ¥ì€ ìš°ì¸¡ í•˜ë‹¨ ê´€ë¦¬ì íŒ¨ë„ì—ì„œ ë¡œê·¸ì¸ í›„ ì‚¬ìš©í•˜ì„¸ìš”.</div>
        </section>
      </div>
    </section>

  </div>
</main>

<!-- Floating Admin Login UI (ì›ë³¸ ìœ ì§€, ê¸°ëŠ¥ì€ ì•„ë˜ moduleì—ì„œ êµ¬í˜„) -->
<div class="admin-fab" style="position:fixed;right:18px;bottom:18px;z-index:200;display:flex;flex-direction:column;align-items:flex-end;gap:10px;">
  <div class="admin-panel" id="adminPanel" style="width:360px;border:1px solid var(--line);border-radius:18px;background:var(--surface);box-shadow:var(--shadow);overflow:hidden;transform:translateY(8px);opacity:0;pointer-events:none;transition:.18s ease;">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid var(--line);background:linear-gradient(135deg, var(--pink-weak), var(--surface));">
      <strong style="font-size:13px;font-weight:950;">ê´€ë¦¬ì ë¡œê·¸ì¸</strong>
      <span style="font-size:12px;font-weight:950;color:var(--pink-strong);" id="adminStateText">LOCK</span>
    </div>
    <div style="padding:12px;">
      <div id="adminLockedBox">
        <div class="note" style="margin-top:0;">ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ê¶Œí•œì„ ìš”ì²­í•˜ì„¸ìš”.</div>
        <div class="field" style="margin:10px 0 0 0;">
          <label>ë‚´ ìš”ì²­ ID</label>
          <input id="clientIdView" type="text" readonly>
        </div>
        <div class="actions" style="margin-top:10px;">
          <button class="btn primary" type="button" onclick="requestAdminAccess()">ê¶Œí•œ ìš”ì²­</button>
          <button class="btn ghost" type="button" onclick="alert('ìŠ¹ì¸ë˜ë©´ ê´€ë¦¬ì íƒ­ê³¼ ë¡œê·¸ì¸ ì…ë ¥ì°½ì´ í‘œì‹œë©ë‹ˆë‹¤.')">ì•ˆë‚´</button>
        </div>
      </div>

      <div id="adminUnlockedBox" style="display:none;">
        <div class="field" style="margin-bottom:10px;">
          <label>ê´€ë¦¬ì ê³ ìœ ë²ˆí˜¸</label>
          <input id="adminRidInput" type="text" placeholder="ì˜ˆ: RW-0001">
        </div>
        <div class="field" style="margin-bottom:10px;">
          <label>ê´€ë¦¬ì ë‹‰ë„¤ì„</label>
          <input id="adminNickInput" type="text" placeholder="ì˜ˆ: ì‹œëšœ">
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn primary" type="button" onclick="adminLoginFromUI()">ê´€ë¦¬ì ON</button>
          <button class="btn ghost" type="button" onclick="adminLogoutFromUI()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
    </div>
  </div>

  <button class="admin-toggle-btn" type="button" onclick="toggleAdminPanel()"
    style="height:48px;min-width:48px;padding:0 14px;border-radius:999px;border:1px solid var(--line);background:var(--surface);color:var(--text);font-weight:950;cursor:pointer;display:flex;align-items:center;gap:8px;box-shadow:0 10px 22px rgba(0,0,0,.08);">
    <span id="adminDot" style="width:10px;height:10px;border-radius:999px;background:rgba(148,163,184,.7);"></span>
    <span id="adminFabText">ê´€ë¦¬ì</span>
  </button>
</div>

<!-- =========================
     Firebase + Firestore (Module)
========================= -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  import {
    getFirestore,
    collection,
    addDoc,
    doc,
    setDoc,
    updateDoc,
    deleteDoc,
    getDocs,
    onSnapshot,
    query,
    orderBy,
    limit,
    serverTimestamp,
    writeBatch
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  /* ===== Firebase init ===== */
  const firebaseConfig = {
    apiKey: "AIzaSyCfMWVHgewbojxk4L-4A_oz8CtUfCUsZGE",
    authDomain: "cafe-985f1.firebaseapp.com",
    projectId: "cafe-985f1",
    storageBucket: "cafe-985f1.firebasestorage.app",
    messagingSenderId: "133444445516",
    appId: "1:133444445516:web:1bebdebd6d26928fd15be9",
    measurementId: "G-1K7L92P1CR"
  };

  const app = initializeApp(firebaseConfig);
  try { getAnalytics(app); } catch(e) {}
  const db = getFirestore(app);

  const $ = (id) => document.getElementById(id);

  /* ===== clientId ===== */
  const clientId = (() => {
    const key = "rw_client_id";
    let v = localStorage.getItem(key);
    if(!v){
      v = "c_" + Math.random().toString(36).slice(2,10) + "_" + Date.now().toString(36);
      localStorage.setItem(key, v);
    }
    return v;
  })();

  /* ===== state ===== */
  let isDark = false;
  let isAllowed = false;
  let allowedDoc = null;
  let isAdmin = false;

  let maidReservations = [];
  let foodOrders = [];

  let cart = [];

  const FOOD = {
    americano:   { name:'ì•„ë©”ë¦¬ì¹´ë…¸', price:100, type:'ì¼ë°˜' },
    strawberry:  { name:'ë”¸ë°” ìŠ¤ë¬´ë””', price:200, type:'ì¼ë°˜' },
    toast:       { name:'ì „ë‚¨ì¹œ í† ìŠ¤íŠ¸', price:100, type:'ì¼ë°˜' },
    pet_water:   { name:'í« ì›Œí„°', price:100, type:'í«(ì˜ˆì•½ì œ)' },
    pet_mineral: { name:'í« ë¯¸ë„¤ë„ ì›Œí„°', price:200, type:'í«(ì˜ˆì•½ì œ)' },
    cat_churu:   { name:'ìº£ì¸„ë¥´', price:100, type:'í«(ì˜ˆì•½ì œ)' },
  };

  /* ===== helpers ===== */
  function fmtTime(d){
    const yy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const hh = String(d.getHours()).padStart(2,'0');
    const mi = String(d.getMinutes()).padStart(2,'0');
    return `${yy}-${mm}-${dd} ${hh}:${mi}`;
  }

  function manwonToEok(totalManwon){
    const eok = totalManwon / 10000;
    return Number.isInteger(eok) ? String(eok) : eok.toFixed(1);
  }

  async function writeAdminLog(type, extra={}){
    await addDoc(collection(db, "adminLogs"), {
      type,
      clientId,
      href: location.href,
      ua: navigator.userAgent,
      createdAt: serverTimestamp(),
      ...extra
    });
  }

  function setClientIdView(){
    const el = $("clientIdView");
    if(el) el.value = clientId;
  }

  /* ===== Theme ===== */
  function toggleTheme(){
    isDark = !isDark;
    if(isDark){
      document.documentElement.setAttribute("data-theme", "dark");
      $("themeIcon").textContent = "â˜€ï¸";
      $("themeText").textContent = "ë¼ì´íŠ¸ ëª¨ë“œ";
    }else{
      document.documentElement.removeAttribute("data-theme");
      $("themeIcon").textContent = "ğŸŒ™";
      $("themeText").textContent = "ë‹¤í¬ ëª¨ë“œ";
    }
  }

  /* ===== View ===== */
  function setView(view){
    if(view === "admin" && !isAdmin){
      alert("ê´€ë¦¬ì ON ìƒíƒœì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
    const target = document.getElementById(`view-${view}`);
    if(target) target.classList.add("active");

    document.querySelectorAll(".tab-btn")
      .forEach(b => b.classList.toggle("active", b.dataset.view === view));

    location.hash = view;
    window.scrollTo({ top: 0, behavior: "smooth" });

    if(view === "status") renderStatus();
  }

  /* ===== Admin panel ===== */
  function toggleAdminPanel(){
    const panel = $("adminPanel");
    if(!panel) return;
    const open = panel.classList.toggle("open");
    panel.style.opacity = open ? "1" : "0";
    panel.style.pointerEvents = open ? "auto" : "none";
    panel.style.transform = open ? "translateY(0)" : "translateY(8px)";
    if(open) setClientIdView();
  }

  async function requestAdminAccess(){
    await writeAdminLog("request_access");
    await setDoc(doc(db, "adminAccess", clientId), {
      clientId,
      allowed: false,
      status: "pending",
      requestedAt: serverTimestamp(),
      updatedAt: serverTimestamp()
    }, { merge: true });
    alert("ê¶Œí•œ ìš”ì²­ ì™„ë£Œ. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
  }

  async function adminLoginFromUI(){
    if(!isAllowed){
      alert("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìŠ¹ì¸ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.");
      return;
    }
    const rid = ($("adminRidInput")?.value || "").trim();
    const nick = ($("adminNickInput")?.value || "").trim();
    if(!rid || !nick){
      alert("ê³ ìœ ë²ˆí˜¸/ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    // (ì„ íƒ) ìŠ¹ì¸ ë¬¸ì„œì— approvedRid/approvedNickê°€ ìˆìœ¼ë©´ ì¼ì¹˜ ì²´í¬
    const ar = String(allowedDoc?.approvedRid || "").trim();
    const an = String(allowedDoc?.approvedNick || "").trim();
    let ok = true;
    if(ar || an) ok = (rid === ar && nick === an);

    await writeAdminLog("admin_login_try", { ok, rid, nick, hasApproved: !!(ar||an) });

    if(!ok){
      alert("ìŠ¹ì¸ ì •ë³´ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }
    isAdmin = true;
    updateAdminUI();
    alert("ê´€ë¦¬ì ON");
  }

  async function adminLogoutFromUI(){
    const was = isAdmin;
    isAdmin = false;
    updateAdminUI();
    if(was) await writeAdminLog("logout");
    alert("ê´€ë¦¬ì OFF");
  }

  function updateAdminUI(){
    const stateText = $("adminStateText");
    const dot = $("adminDot");
    const fabText = $("adminFabText");

    const adminTab = $("adminTab");
    const adminTabLock = $("adminTabLock");
    const lockedBox = $("adminLockedBox");
    const unlockedBox = $("adminUnlockedBox");

    if(isAdmin){
      if(stateText) stateText.textContent = "ADMIN ON";
      if(dot) { dot.style.background = "var(--pink-strong)"; }
      if(fabText) fabText.textContent = "ê´€ë¦¬ì ON";
    } else if(isAllowed){
      if(stateText) stateText.textContent = "LOGIN READY";
      if(dot) { dot.style.background = "rgba(148,163,184,.7)"; }
      if(fabText) fabText.textContent = "ê´€ë¦¬ì(ê¶Œí•œë¨)";
    } else {
      if(stateText) stateText.textContent = "LOCK";
      if(dot) { dot.style.background = "rgba(148,163,184,.7)"; }
      if(fabText) fabText.textContent = "ê´€ë¦¬ì";
    }

    if(adminTab){
      adminTab.style.display = isAllowed ? "" : "none";
      if(adminTabLock) adminTabLock.textContent = isAdmin ? "ğŸŸ£" : "ğŸ”“";
    }

    if(lockedBox) lockedBox.style.display = isAllowed ? "none" : "";
    if(unlockedBox) unlockedBox.style.display = isAllowed ? "" : "none";

    if(!isAdmin && document.querySelector(".view.active")?.id === "view-admin"){
      setView("home");
    }

    renderStatus();
  }

  /* =========================
     âœ… ê´€ë¦¬ì: ì˜ˆì•½ í˜„í™©ì—ì„œ ì‚­ì œ ê¸°ëŠ¥
  ========================= */
  async function adminDeleteMaidReservation(docId){
    if(!isAdmin){
      alert("ê´€ë¦¬ì ON í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    if(!confirm("ì´ ë©”ì´ë“œ ì˜ˆì•½ì„ ì‚­ì œí• ê¹Œìš”? (Firestoreì—ì„œ ì‚­ì œ)")) return;
    await deleteDoc(doc(db, "maidReservations", docId));
    await writeAdminLog("delete_maid_reservation", { docId });
  }

  async function adminDeleteFoodOrder(docId){
    if(!isAdmin){
      alert("ê´€ë¦¬ì ON í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    if(!confirm("ì´ ìŒì‹ ì£¼ë¬¸ì„ ì‚­ì œí• ê¹Œìš”? (Firestoreì—ì„œ ì‚­ì œ)")) return;
    await deleteDoc(doc(db, "foodOrders", docId));
    await writeAdminLog("delete_food_order", { docId });
  }

  /* ===== Maid submit ===== */
  function resetMaidForm(){
    $("maidName").value = "";
    $("maidDate").value = "";
    $("maidTime").value = "";
    $("maidRid").value = "";
    $("maidUser").value = "";
    $("maidPeople").value = "";
    $("maidDiscord").value = "";
  }

  async function submitMaid(){
    const maid = $("maidName").value.trim();
    const date = $("maidDate").value;
    const time = $("maidTime").value;
    const rid = $("maidRid").value.trim();
    const name = $("maidUser").value.trim();
    const discord = $("maidDiscord").value.trim();
    const people = parseInt($("maidPeople").value, 10);

    if(!maid || !date || !time || !rid || !name || !discord){
      alert("ë©”ì´ë“œ ì˜ˆì•½: ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    if(!Number.isFinite(people) || people < 1){
      alert("ì´ ì¸ì›ìˆ˜ëŠ” 1ëª… ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    await addDoc(collection(db, "maidReservations"), {
      ts: serverTimestamp(),
      clientId,
      rid, name, discord, maid, date, time, people
    });

    alert("ë©”ì´ë“œ ì˜ˆì•½ ì ‘ìˆ˜ ì™„ë£Œ!");
    resetMaidForm();
    setView("status");
  }

  /* ===== Cart ===== */
  function addToCart(){
    const key = $("foodMenu").value;
    const qty = parseInt($("foodQty").value, 10);
    if(!Number.isFinite(qty) || qty < 100){
      alert("ìµœì†Œ 100ê°œë¶€í„° ë‹´ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      $("foodQty").value = 100;
      return;
    }
    const item = FOOD[key];
    if(!item) return;

    const found = cart.find(i => i.key === key);
    if(found) found.qty += qty;
    else cart.push({ key, name:item.name, price:item.price, type:item.type, qty });

    renderCart();
  }

  function removeFromCart(key){
    cart = cart.filter(i => i.key !== key);
    renderCart();
  }

  function clearCart(){
    cart = [];
    renderCart();
    $("foodMenu").selectedIndex = 0;
    $("foodQty").value = 100;
  }

  function renderCart(){
    const list = $("cartList");
    const totalEl = $("cartTotal");
    if(!list || !totalEl) return;

    list.innerHTML = "";
    let totalManwon = 0;

    if(cart.length === 0){
      const empty = document.createElement("li");
      empty.style.borderBottom = "none";
      empty.innerHTML = `<div class="cart-meta"><div>ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆì–´ìš”.</div><div class="muted">ì™¼ìª½ì—ì„œ ë©”ë‰´ë¥¼ ë‹´ì•„ì£¼ì„¸ìš”.</div></div>`;
      list.appendChild(empty);
      totalEl.textContent = "0";
      return;
    }

    cart.forEach(i=>{
      const sum = i.qty * i.price;
      totalManwon += sum;

      const li = document.createElement("li");
      const left = document.createElement("div");
      left.className = "cart-meta";
      left.innerHTML = `<div><strong>${i.name}</strong> Ã— ${i.qty}</div><div class="muted">${i.type} Â· ${i.price}ë§Œì›/ê°œ</div>`;

      const right = document.createElement("div");
      right.style.textAlign = "right";
      right.innerHTML = `
        <div><strong>${manwonToEok(sum)}</strong>ì–µ</div>
        <button class="btn small ghost" type="button" style="margin-top:6px;" onclick="removeFromCart('${i.key}')">ì‚­ì œ</button>
      `;

      li.appendChild(left);
      li.appendChild(right);
      list.appendChild(li);
    });

    totalEl.textContent = manwonToEok(totalManwon);
  }

  async function confirmFoodOrder(){
    if(cart.length === 0){
      alert("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆì–´ìš”.");
      return;
    }
    const rid = $("foodRid").value.trim();
    const name = $("foodUser").value.trim();
    const discord = $("foodDiscord").value.trim();
    if(!rid || !name || !discord){
      alert("ì˜ˆì•½ ê³ ìœ ë²ˆí˜¸/ì´ë¦„/ë””ìŠ¤ì½”ë“œ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    let totalManwon = 0;
    cart.forEach(i => totalManwon += i.qty * i.price);

    await addDoc(collection(db, "foodOrders"), {
      ts: serverTimestamp(),
      clientId,
      rid, name, discord,
      items: cart.map(i => ({...i})),
      totalManwon
    });

    alert("ìŒì‹ ì£¼ë¬¸ í™•ì •!");
    clearCart();
    setView("status");
  }

  /* ===== Status render ===== */
  function renderStatus(){
    const qv = ($("statusSearch")?.value || "").trim().toLowerCase();

    // âœ… ê´€ë¦¬ìë©´ ì „ì²´, ì•„ë‹ˆë©´ ë³¸ì¸(clientId)ë§Œ
    const maidBase = isAdmin ? maidReservations : maidReservations.filter(r => r.clientId === clientId);
    const foodBase = isAdmin ? foodOrders : foodOrders.filter(o => o.clientId === clientId);

    $("kpiMaid").textContent = String(maidBase.length);
    $("kpiFood").textContent = String(foodBase.length);
    const foodTotal = foodBase.reduce((acc, o) => acc + (o.totalManwon || 0), 0);
    $("kpiFoodTotal").textContent = manwonToEok(foodTotal);

    // âœ… ì‚­ì œ í—¤ë” í‘œì‹œ/ìˆ¨ê¹€
    const maidDelHead = $("maidDelHead");
    const foodDelHead = $("foodDelHead");
    if(maidDelHead) maidDelHead.style.display = isAdmin ? "" : "none";
    if(foodDelHead) foodDelHead.style.display = isAdmin ? "" : "none";

    const maidFiltered = maidBase.filter(r => {
      if(!qv) return true;
      return (
        String(r.rid||"").toLowerCase().includes(qv) ||
        String(r.name||"").toLowerCase().includes(qv) ||
        String(r.discord||"").toLowerCase().includes(qv) ||
        String(r.maid||"").toLowerCase().includes(qv)
      );
    });

    $("maidStatusBody").innerHTML = maidFiltered.length
      ? maidFiltered.map(r => `
        <tr>
          <td>${r.ts ? fmtTime(r.ts) : "<span class='muted-small'>(ì²˜ë¦¬ì¤‘)</span>"}</td>
          <td><span class="pill">${r.rid || ""}</span></td>
          <td>${r.name || ""}</td>
          <td>${r.discord || ""}</td>
          <td>${r.maid || ""}</td>
          <td>${r.date || ""}</td>
          <td>${r.time || ""}</td>
          <td>${r.people ?? ""}</td>
          ${isAdmin ? `<td><button class="btn small ghost" type="button" onclick="adminDeleteMaidReservation('${r.id}')">ì‚­ì œ</button></td>` : ``}
        </tr>
      `).join("")
      : `<tr><td colspan="${isAdmin ? 9 : 8}" class="muted-small">í‘œì‹œí•  ë©”ì´ë“œ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;

    const foodFiltered = foodBase.filter(o => {
      if(!qv) return true;
      return (
        String(o.rid||"").toLowerCase().includes(qv) ||
        String(o.name||"").toLowerCase().includes(qv) ||
        String(o.discord||"").toLowerCase().includes(qv) ||
        (o.items || []).some(i => String(i.name||"").toLowerCase().includes(qv))
      );
    });

    $("foodStatusBody").innerHTML = foodFiltered.length
      ? foodFiltered.map(o => {
          const detail = (o.items || []).map(i => `${i.name}Ã—${i.qty}`).join(", ");
          return `
            <tr>
              <td>${o.ts ? fmtTime(o.ts) : "<span class='muted-small'>(ì²˜ë¦¬ì¤‘)</span>"}</td>
              <td><span class="pill">${o.rid || ""}</span></td>
              <td>${o.name || ""}</td>
              <td>${o.discord || ""}</td>
              <td>${manwonToEok(o.totalManwon || 0)}ì–µ</td>
              <td>${detail}</td>
              ${isAdmin ? `<td><button class="btn small ghost" type="button" onclick="adminDeleteFoodOrder('${o.id}')">ì‚­ì œ</button></td>` : ``}
            </tr>`;
        }).join("")
      : `<tr><td colspan="${isAdmin ? 7 : 6}" class="muted-small">í‘œì‹œí•  ìŒì‹ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
  }

  /* ===== delete all (admin only) ===== */
  async function clearAllStatus(){
    if(!isAdmin){
      alert("ê´€ë¦¬ì ON í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    if(!confirm("ì •ë§ ì „ì²´ ì˜ˆì•½ì„ Firestoreì—ì„œ ì‚­ì œí• ê¹Œìš”?")) return;

    const batch = writeBatch(db);

    const maidSnap = await getDocs(query(collection(db, "maidReservations"), limit(500)));
    maidSnap.forEach(d => batch.delete(d.ref));

    const foodSnap = await getDocs(query(collection(db, "foodOrders"), limit(500)));
    foodSnap.forEach(d => batch.delete(d.ref));

    await batch.commit();
    alert("ì‚­ì œ ì™„ë£Œ (ìµœëŒ€ 500ê°œ ë²”ìœ„).");
    await writeAdminLog("delete_all", {});
  }

  /* ===== watchers ===== */
  function startFirestoreWatchers(){
    onSnapshot(query(collection(db, "maidReservations"), orderBy("ts", "desc"), limit(500)), (snap) => {
      maidReservations = snap.docs.map(d => {
        const v = d.data();
        return { id: d.id, ...v, ts: v.ts?.toDate ? v.ts.toDate() : null };
      });
      renderStatus();
    });

    onSnapshot(query(collection(db, "foodOrders"), orderBy("ts", "desc"), limit(500)), (snap) => {
      foodOrders = snap.docs.map(d => {
        const v = d.data();
        return { id: d.id, ...v, ts: v.ts?.toDate ? v.ts.toDate() : null };
      });
      renderStatus();
    });

    onSnapshot(doc(db, "adminAccess", clientId), (snap) => {
      if(!snap.exists()){
        allowedDoc = null;
        isAllowed = false;
        if(isAdmin) isAdmin = false;
        updateAdminUI();
        return;
      }
      allowedDoc = snap.data() || null;
      isAllowed = !!allowedDoc.allowed;
      if(!isAllowed && isAdmin) isAdmin = false;
      updateAdminUI();
    });
  }

  /* ===== init ===== */
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => setView(btn.dataset.view));
    });

    const initial = (location.hash || "#maid").replace("#","");
    setView(["home","maid","food","status","admin"].includes(initial) ? initial : "maid");

    renderCart();
    renderStatus();
    updateAdminUI();
    startFirestoreWatchers();
    setClientIdView();
  });

  /* ===== expose to window ===== */
  window.setView = setView;
  window.toggleTheme = toggleTheme;

  window.toggleAdminPanel = toggleAdminPanel;
  window.requestAdminAccess = requestAdminAccess;
  window.adminLoginFromUI = adminLoginFromUI;
  window.adminLogoutFromUI = adminLogoutFromUI;

  window.resetMaidForm = resetMaidForm;
  window.submitMaid = submitMaid;

  window.addToCart = addToCart;
  window.removeFromCart = removeFromCart;
  window.clearCart = clearCart;
  window.confirmFoodOrder = confirmFoodOrder;

  window.renderStatus = renderStatus;
  window.clearAllStatus = clearAllStatus;

  /* âœ… ì‚­ì œ í•¨ìˆ˜ ì „ì—­ ë°”ì¸ë”© (ë²„íŠ¼ onclickì—ì„œ í˜¸ì¶œ) */
  window.adminDeleteMaidReservation = adminDeleteMaidReservation;
  window.adminDeleteFoodOrder = adminDeleteFoodOrder;
</script>

</body>
</html>
